<mxfile host="drawio-plugin" modified="2022-08-17T18:41:39.334Z" agent="5.0 (Windows NT 6.2; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.141 Safari/537.36" etag="ad3kXP6NwqNOqtJlPNAt" version="15.5.4" type="embed"><diagram id="JEqR1ZIYFnEfZMCUsHCR" name="Page-1"><mxGraphModel dx="1067" dy="618" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0"><root><mxCell id="0"/><mxCell id="1" parent="0"/><mxCell id="wrNmaZZdg3NfsRJvNCuY-1" value="&lt;font style=&quot;font-size: 10px&quot;&gt;websocket链路&lt;/font&gt;" style="swimlane;html=1;childLayout=stackLayout;startSize=20;rounded=0;shadow=0;labelBackgroundColor=none;strokeWidth=1;fontFamily=Verdana;fontSize=8;align=center;" parent="1" vertex="1"><mxGeometry x="70" y="40" width="585" height="470" as="geometry"/></mxCell><mxCell id="wrNmaZZdg3NfsRJvNCuY-4" style="edgeStyle=orthogonalEdgeStyle;rounded=1;html=1;labelBackgroundColor=none;startArrow=none;startFill=0;startSize=5;endArrow=classicThin;endFill=1;endSize=5;jettySize=auto;orthogonalLoop=1;strokeWidth=1;fontFamily=Verdana;fontSize=8" parent="wrNmaZZdg3NfsRJvNCuY-1" target="wrNmaZZdg3NfsRJvNCuY-6" edge="1"><mxGeometry relative="1" as="geometry"><mxPoint x="110" y="115" as="sourcePoint"/></mxGeometry></mxCell><mxCell id="wrNmaZZdg3NfsRJvNCuY-2" value="user" style="swimlane;html=1;startSize=20;" parent="wrNmaZZdg3NfsRJvNCuY-1" vertex="1"><mxGeometry y="20" width="170" height="450" as="geometry"/></mxCell><mxCell id="wrNmaZZdg3NfsRJvNCuY-3" value="Actor" style="shape=umlActor;verticalLabelPosition=bottom;verticalAlign=top;html=1;outlineConnect=0;" parent="wrNmaZZdg3NfsRJvNCuY-2" vertex="1"><mxGeometry x="65" y="70" width="30" height="60" as="geometry"/></mxCell><mxCell id="wrNmaZZdg3NfsRJvNCuY-5" value="home" style="swimlane;html=1;startSize=20;" parent="wrNmaZZdg3NfsRJvNCuY-1" vertex="1"><mxGeometry x="170" y="20" width="255" height="450" as="geometry"/></mxCell><mxCell id="wrNmaZZdg3NfsRJvNCuY-6" value="&lt;font style=&quot;font-size: 12px&quot;&gt;localhost:8080&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;shadow=0;labelBackgroundColor=none;strokeWidth=1;fontFamily=Verdana;fontSize=8;align=center;" parent="wrNmaZZdg3NfsRJvNCuY-5" vertex="1"><mxGeometry x="35" y="70" width="125" height="50" as="geometry"/></mxCell><mxCell id="27" value="&lt;font style=&quot;font-size: 12px&quot;&gt;本地Js建立长连接&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;shadow=0;labelBackgroundColor=none;strokeWidth=1;fontFamily=Verdana;fontSize=8;align=center;" vertex="1" parent="wrNmaZZdg3NfsRJvNCuY-5"><mxGeometry x="35" y="192.5" width="125" height="37.5" as="geometry"/></mxCell><mxCell id="26" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontColor=#000000;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="wrNmaZZdg3NfsRJvNCuY-5" source="wrNmaZZdg3NfsRJvNCuY-6" target="27"><mxGeometry relative="1" as="geometry"><mxPoint x="79.66666666666674" y="170" as="targetPoint"/></mxGeometry></mxCell><mxCell id="29" value="&lt;div&gt;&lt;font style=&quot;font-size: 12px&quot;&gt;new WebSocket(&quot;ws://&quot; + document.location.host + &quot;/ws&quot;);&amp;nbsp;&lt;/font&gt;&lt;/div&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=10;fontColor=#000000;" vertex="1" parent="wrNmaZZdg3NfsRJvNCuY-5"><mxGeometry x="-75" y="237.5" width="330" height="20" as="geometry"/></mxCell><mxCell id="wrNmaZZdg3NfsRJvNCuY-49" value="websocket" style="swimlane;html=1;startSize=20;" parent="wrNmaZZdg3NfsRJvNCuY-1" vertex="1"><mxGeometry x="425" y="20" width="160" height="450" as="geometry"/></mxCell><mxCell id="19" value="&lt;font style=&quot;font-size: 12px&quot;&gt;长连接地址&lt;br&gt;ws://localhost:8080/ws&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;shadow=0;labelBackgroundColor=none;strokeWidth=1;fontFamily=Verdana;fontSize=8;align=center;" parent="wrNmaZZdg3NfsRJvNCuY-49" vertex="1"><mxGeometry x="25" y="75" width="125" height="45" as="geometry"/></mxCell><mxCell id="31" value="&lt;font&gt;&lt;font style=&quot;font-size: 12px&quot;&gt;创建一个client实例&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;shadow=0;labelBackgroundColor=none;strokeWidth=1;fontFamily=Verdana;fontSize=8;align=center;" vertex="1" parent="wrNmaZZdg3NfsRJvNCuY-49"><mxGeometry x="25" y="160" width="125" height="45" as="geometry"/></mxCell><mxCell id="30" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=12;fontColor=#000000;" edge="1" parent="wrNmaZZdg3NfsRJvNCuY-49" source="19" target="31"><mxGeometry relative="1" as="geometry"><mxPoint x="87.16666666666674" y="170" as="targetPoint"/></mxGeometry></mxCell><mxCell id="39" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=10;fontColor=#000000;" edge="1" parent="wrNmaZZdg3NfsRJvNCuY-49" source="37" target="38"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="37" value="&lt;font&gt;&lt;font style=&quot;font-size: 12px&quot;&gt;创建发送消息协程&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;shadow=0;labelBackgroundColor=none;strokeWidth=1;fontFamily=Verdana;fontSize=8;align=center;" vertex="1" parent="wrNmaZZdg3NfsRJvNCuY-49"><mxGeometry x="25" y="240" width="125" height="45" as="geometry"/></mxCell><mxCell id="38" value="&lt;font&gt;&lt;span style=&quot;font-size: 12px&quot;&gt;创建监听消息协程&lt;/span&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;shadow=0;labelBackgroundColor=none;strokeWidth=1;fontFamily=Verdana;fontSize=8;align=center;" vertex="1" parent="wrNmaZZdg3NfsRJvNCuY-49"><mxGeometry x="25" y="320" width="125" height="45" as="geometry"/></mxCell><mxCell id="36" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=10;fontColor=#000000;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="wrNmaZZdg3NfsRJvNCuY-49" source="31" target="37"><mxGeometry relative="1" as="geometry"><mxPoint x="87.16666666666674" y="270" as="targetPoint"/><Array as="points"/></mxGeometry></mxCell><mxCell id="28" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontColor=#000000;" edge="1" parent="wrNmaZZdg3NfsRJvNCuY-1" source="27" target="19"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="34" value="&lt;h1&gt;&lt;font style=&quot;font-size: 14px&quot;&gt;Client结构&lt;/font&gt;&lt;/h1&gt;&lt;p&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;type Client struct {&lt;br&gt;&amp;nbsp; &amp;nbsp;hub *Hub&lt;br&gt;&amp;nbsp; &amp;nbsp;// 连接句柄&lt;br&gt;&amp;nbsp; &amp;nbsp;conn *websocket.Conn&lt;br&gt;&amp;nbsp; &amp;nbsp;// 待发送数据&lt;br&gt;&amp;nbsp; &amp;nbsp;send chan []byte&lt;br&gt;}&lt;/font&gt;&lt;br&gt;&lt;/p&gt;" style="text;html=1;strokeColor=none;fillColor=none;spacing=5;spacingTop=-20;whiteSpace=wrap;overflow=hidden;rounded=0;fontSize=12;fontColor=#000000;" vertex="1" parent="1"><mxGeometry x="680" y="162.5" width="190" height="160" as="geometry"/></mxCell><mxCell id="35" value="" style="endArrow=none;dashed=1;html=1;dashPattern=1 3;strokeWidth=2;rounded=0;fontSize=10;fontColor=#000000;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="31" target="34"><mxGeometry width="50" height="50" relative="1" as="geometry"><mxPoint x="780" y="400" as="sourcePoint"/><mxPoint x="830" y="350" as="targetPoint"/></mxGeometry></mxCell><mxCell id="40" value="" style="endArrow=none;dashed=1;html=1;dashPattern=1 3;strokeWidth=2;rounded=0;fontSize=10;fontColor=#000000;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" edge="1" parent="1" source="37"><mxGeometry width="50" height="50" relative="1" as="geometry"><mxPoint x="770" y="400" as="sourcePoint"/><mxPoint x="720" y="360" as="targetPoint"/></mxGeometry></mxCell><mxCell id="42" value="&lt;h1&gt;&lt;font style=&quot;font-size: 14px&quot;&gt;代码结构&lt;/font&gt;&lt;/h1&gt;&lt;p&gt;for {&lt;/p&gt;&lt;p&gt;&amp;nbsp; &amp;nbsp;select {&lt;/p&gt;&lt;p&gt;&amp;nbsp; &amp;nbsp;case message, ok := &amp;lt;-c.send:&lt;/p&gt;&lt;p&gt;&amp;nbsp; &amp;nbsp;case &amp;lt;-ticker.C:&lt;/p&gt;&lt;p&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/p&gt;&lt;p&gt;}&lt;/p&gt;" style="text;html=1;strokeColor=none;fillColor=none;spacing=5;spacingTop=-20;whiteSpace=wrap;overflow=hidden;rounded=0;fontSize=10;fontColor=#000000;" vertex="1" parent="1"><mxGeometry x="720" y="330" width="190" height="170" as="geometry"/></mxCell></root></mxGraphModel></diagram></mxfile>